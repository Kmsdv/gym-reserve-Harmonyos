import { router, promptAction } from '@kit.ArkUI';
import DBTools from '../utils/DBTools';
import { relationalStore } from '@kit.ArkData';
import { BusinessError } from '@kit.BasicServicesKit';

@Entry
@Component
struct Register {
  @State message: string = 'åˆ›å»ºè´¦å·';
  @State username: string = '';
  @State password: string = '';

  //æ„å»ºUI
  build() {
    Column() {
      // Header
      Column() {
        Text('ğŸ“')
          .fontSize(60)
          .margin({ bottom: 10 })
        Text(this.message)
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333')
        Text('Join us today!')
          .fontSize(14)
          .fontColor('#999')
          .margin({ top: 5 })
      }
      .margin({ top: 60, bottom: 40 })

      // è¾“å…¥æ¡†åŒºåŸŸ
      Column({ space: 20 }) {
        // ç”¨æˆ·å
        Row() {
          Text('ğŸ‘¤')
            .fontSize(20)
            .margin({ right: 10 })
          TextInput({ placeholder: 'è¯·è¾“å…¥ç”¨æˆ·å', text: this.username })
            .fontSize(16)
            .layoutWeight(1)
            .backgroundColor(Color.Transparent)
            .onChange((value) => {
              this.username = value;
            })
        }
        .padding({ left: 15, right: 15 })
        .height(50)
        .backgroundColor(Color.White)
        .borderRadius(25)
        .shadow({ radius: 5, color: '#1F000000', offsetY: 2 })

        // å¯†ç 
        Row() {
          Text('ğŸ”’')
            .fontSize(20)
            .margin({ right: 10 })
          TextInput({ placeholder: 'è¯·è¾“å…¥å¯†ç ', text: this.password })
            .fontSize(16)
            .layoutWeight(1)
            .type(InputType.Password)
            .backgroundColor(Color.Transparent)
            .onChange((value) => {
              this.password = value;
            })
        }
        .padding({ left: 15, right: 15 })
        .height(50)
        .backgroundColor(Color.White)
        .borderRadius(25)
        .shadow({ radius: 5, color: '#1F000000', offsetY: 2 })
      }
      .width('85%')

      // å»ç™»å½•
      Row() {
        Text('å·²æœ‰è´¦å·ï¼Ÿ')
          .fontColor('#666')
          .fontSize(14)
        Text('ç›´æ¥ç™»å½•')
          .fontColor('#1698CE')
          .fontSize(14)
          .fontWeight(FontWeight.Bold)
          .onClick(() => {
            router.pushUrl({ url: 'pages/Index' })
          })
      }
      .width('85%')
      .justifyContent(FlexAlign.End)
      .margin({ top: 15, bottom: 40 })

      // æ³¨å†ŒæŒ‰é’®
      Button('ç«‹å³æ³¨å†Œ')
        .width('85%')
        .height(50)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .backgroundColor('#1698CE')
        .shadow({ radius: 5, color: '#4F1698CE', offsetY: 3 })
        .onClick(() => {
          let data: relationalStore.ValuesBucket = {
            'username': this.username,
            'password_hash': this.password,
            'phone': '13800000000', // é»˜è®¤æ‰‹æœºå·ï¼Œå®é™…é¡¹ç›®ä¸­åº”ç”±ç”¨æˆ·è¾“å…¥
            'full_name': 'New User',
            'created_at': new Date().toISOString()
          }
          if (this.username != '' && this.password != '') {
            DBTools.insert('users', data).then((data) => {
              promptAction.showToast({ message: 'ç”¨æˆ·æ³¨å†ŒæˆåŠŸ' })
              setTimeout(() => {
                router.back();
              }, 1000);
            }).catch((err: BusinessError) => {
              console.log(err.message);
              promptAction.showToast({ message: 'æ³¨å†Œå¤±è´¥: ' + err.message })
            })
          } else {
            promptAction.showToast({ message: 'ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©º' })
          }
        });

    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F5F7FA')
  }
}
